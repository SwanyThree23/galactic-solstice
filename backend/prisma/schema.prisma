generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id            String    @id @default(uuid())
  username      String    @unique
  email         String    @unique
  password      String
  avatar        String?
  bio           String?
  isCreator     Boolean   @default(false)
  walletAddress String?
  revenue       Float     @default(0)
  streams       Stream[]
  videos        Video[]
  comments      Comment[]
  likes         Like[]
  donations     Donation[] @relation("DonationSender")
  earnings      Donation[] @relation("DonationReceiver")
  socialShares  SocialShare[]
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Stream {
  id            String    @id @default(uuid())
  userId        String
  user          User      @relation(fields: [userId], references: [id])
  title         String
  description   String?
  category      String?
  thumbnail     String?
  isLive        Boolean   @default(false)
  viewCount     Int       @default(0)
  maxViewers    Int       @default(0)
  streamKey     String    @unique
  pushUrl       String?
  rtmpUrl       String?
  isPrivate     Boolean   @default(false)
  password      String?
  config        String?   // Layout, guests, etc.
  guests        Guest[]
  comments      Comment[]
  likes         Like[]
  donations     Donation[]
  highlights    Highlight[]
  clippingLogs  ClippingLog[]
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Guest {
  id            String    @id @default(uuid())
  streamId      String
  stream        Stream    @relation(fields: [streamId], references: [id])
  userId        String?
  name          String?
  avatar        String?
  isMuted       Boolean   @default(false)
  hasVideo      Boolean   @default(true)
  role          String    @default("guest") // guest, cohost
  joinedAt      DateTime  @default(now())
}

model Video {
  id            String    @id @default(uuid())
  userId        String
  user          User      @relation(fields: [userId], references: [id])
  title         String
  url           String
  thumbnail     String?
  duration      Int?
  views         Int       @default(0)
  isShort       Boolean   @default(false)
  likes         Like[]
  comments      Comment[]
  createdAt     DateTime  @default(now())
}

model Comment {
  id            String    @id @default(uuid())
  content       String
  userId        String
  user          User      @relation(fields: [userId], references: [id])
  streamId      String?
  stream        Stream?   @relation(fields: [streamId], references: [id])
  videoId       String?
  video         Video?    @relation(fields: [videoId], references: [id])
  createdAt     DateTime  @default(now())
}

model Like {
  id            String    @id @default(uuid())
  userId        String
  user          User      @relation(fields: [userId], references: [id])
  streamId      String?
  stream        Stream?   @relation(fields: [streamId], references: [id])
  videoId       String?
  video         Video?    @relation(fields: [videoId], references: [id])
  createdAt     DateTime  @default(now())
}

model Donation {
  id            String    @id @default(uuid())
  amount        Float
  currency      String    @default("USD")
  senderId      String
  sender        User      @relation("DonationSender", fields: [senderId], references: [id])
  receiverId    String
  receiver      User      @relation("DonationReceiver", fields: [receiverId], references: [id])
  streamId      String?
  stream        Stream?   @relation(fields: [streamId], references: [id])
  method        String?   // PayPal, Venmo, etc.
  status        String    @default("pending")
  createdAt     DateTime  @default(now())
}

model SocialShare {
  id            String    @id @default(uuid())
  userId        String
  user          User      @relation(fields: [userId], references: [id])
  platform      String    // Instagram, Facebook, etc.
  contentType   String    // stream, video
  contentId     String
  shareUrl      String
  embeddedViews Int       @default(0)
  appInstalls   Int       @default(0)
  createdAt     DateTime  @default(now())
}

model Highlight {
  id            String    @id @default(uuid())
  streamId      String
  stream        Stream    @relation(fields: [streamId], references: [id])
  startTime     Int
  endTime       Int
  description   String?
  videoUrl      String?
  createdAt     DateTime  @default(now())
}

model ClippingLog {
  id            String    @id @default(uuid())
  streamId      String
  stream        Stream    @relation(fields: [streamId], references: [id])
  timestamp     DateTime  @default(now())
  status        String
}

model Paywall {
  id            String    @id @default(uuid())
  streamId      String    @unique
  price         Float
  accessTier    String    @default("premium") // premium, vip
}

model AccessTier {
  id            String    @id @default(uuid())
  name          String    @unique
  benefits      String?
}

model AnalyticRecord {
  id            String    @id @default(uuid())
  entityType    String    // user, stream, video
  entityId      String
  metric        String    // view, retention, click
  value         Float
  timestamp     DateTime  @default(now())
}

model MultiStreamConfig {
  id            String    @id @default(uuid())
  streamId      String
  platform      String    // YouTube, Twitch, Facebook
  rtmpUrl       String
  streamKey     String
  isActive      Boolean   @default(true)
}

model AIAction {
  id            String    @id @default(uuid())
  streamId      String
  agentId       String
  actionType    String    // scene_change, mute_guest, highlight_detected
  payload       String?
  timestamp     DateTime  @default(now())
}

model Notification {
  id            String    @id @default(uuid())
  userId        String
  title         String
  message       String
  isRead        Boolean   @default(false)
  createdAt     DateTime  @default(now())
}

model PaymentMethod {
  id            String    @id @default(uuid())
  userId        String
  provider      String    // Chime, Zelle, etc.
  details       String?
}

model Wallet {
  id            String    @id @default(uuid())
  userId        String    @unique
  balance       Float     @default(0)
  currency      String    @default("USD")
}

model RetentionMetric {
  id            String    @id @default(uuid())
  streamId      String
  minute        Int
  viewerCount   Int
}

model SystemLog {
  id            String    @id @default(uuid())
  level         String
  message       String
  context       String?
  timestamp     DateTime  @default(now())
}
